{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Squash to Main for Publication",
      "type": "shell",
      "command": "source .venv/bin/activate && echo 'ğŸ§ª Running tests...' && python -m pytest packages/bastion/tests/ packages/core/tests/ packages/airgap/tests/ packages/seeder/tests/ -m 'not integration' -q && echo 'âœ… Tests passed!' && git checkout main && git merge --squash develop && git commit -m \"${input:commitMessage}\" && echo 'âœ… Squashed to main' && git checkout develop",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Squash to Main (with push)",
      "type": "shell",
      "command": "source .venv/bin/activate && echo 'ğŸ§ª Running tests...' && python -m pytest packages/bastion/tests/ packages/core/tests/ packages/airgap/tests/ packages/seeder/tests/ -m 'not integration' -q && echo 'âœ… Tests passed!' && git checkout main && git merge --squash develop && (git diff --cached --quiet && echo 'ğŸ“ No changes to commit' || git commit -m \"${input:commitMessage}\") && git push public main && echo 'âœ… Pushed to public/main' && git checkout develop",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Run Tests (Unit)",
      "type": "shell",
      "command": "source .venv/bin/activate && echo 'ğŸ§ª Testing bastion...' && python -m pytest packages/bastion/tests/ -m 'not integration' -q && echo 'ğŸ§ª Testing core...' && python -m pytest packages/core/tests/ -m 'not integration' -q && echo 'ğŸ§ª Testing airgap...' && python -m pytest packages/airgap/tests/ -m 'not integration' -q && echo 'ğŸ§ª Testing seeder...' && python -m pytest packages/seeder/tests/ -m 'not integration' -q && echo 'âœ… All tests passed!'",
      "problemMatcher": [],
      "group": "test"
    },
    {
      "label": "Lint Check",
      "type": "shell",
      "command": "source .venv/bin/activate && python -m ruff check packages/bastion/ packages/core/ packages/airgap/ packages/seeder/",
      "problemMatcher": [],
      "group": "test"
    },
    {
      "label": "Lint Fix",
      "type": "shell",
      "command": "source .venv/bin/activate && echo 'ğŸ”§ Fixing safe linting issues...' && python -m ruff check --fix packages/bastion/ packages/core/ packages/airgap/ packages/seeder/ && echo 'ğŸ”§ Fixing unsafe linting issues...' && python -m ruff check --fix --unsafe-fixes packages/bastion/ packages/core/ packages/airgap/ packages/seeder/ && echo 'âœ… Linting fixed!'",
      "problemMatcher": [],
      "group": "test"
    },
    {
      "label": "Preview Pages (Jekyll)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "cd docs && bundle install && (sleep 3 && open http://localhost:4000 &) && bundle exec jekyll serve --livereload"
      ],
      "isBackground": true,
      "problemMatcher": {
        "pattern": {
          "regexp": "^.*$"
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^.*Server running at.*",
          "endsPattern": "^.*"
        }
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "new"
      },
      "group": {
        "kind": "build",
        "isDefault": false
      }
    },
    {
      "label": "Generate Brand Assets",
      "type": "shell",
      "command": "bash",
      "args": [
        "scripts/generate-brand-assets.sh"
      ],
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "group": {
        "kind": "build",
        "isDefault": false
      }
    },
    {
      "label": "Build & Check Packages (Pre-PyPI)",
      "type": "shell",
      "command": "source .venv/bin/activate && echo 'ğŸ”§ Building bastion-core...' && (cd packages/core && python -m build) && echo 'ğŸ”§ Building bastion-security...' && (cd packages/bastion && python -m build) && echo 'ğŸ”§ Building bastion-airgap...' && (cd packages/airgap && python -m build) && echo 'ğŸ”§ Building bastion-seeder...' && (cd packages/seeder && python -m build) && echo 'âœ… All packages built!' && echo 'ğŸ§ª Checking packages with twine...' && python -m pip install twine -q && twine check packages/*/dist/* && echo 'âœ… All packages valid for PyPI!'",
      "problemMatcher": [],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Publish to TestPyPI (Pre-Release Check)",
      "type": "shell",
      "command": "source .venv/bin/activate && echo 'ğŸ“¦ Building all packages...' && (cd packages/core && python -m build) && (cd packages/bastion && python -m build) && (cd packages/airgap && python -m build) && (cd packages/seeder && python -m build) && echo 'ğŸ§ª Verifying packages...' && python -m pip install twine -q && twine check packages/*/dist/* && echo 'ğŸ“¤ Publishing to TestPyPI (requires ~/.pypirc [testpypi])...' && twine upload --repository testpypi packages/*/dist/* && echo 'âœ… Published to TestPyPI! Verify at https://test.pypi.org/'",
      "problemMatcher": [],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    }
  ],
  "inputs": [
    {
      "id": "commitMessage",
      "type": "promptString",
      "description": "Commit message for squashed release",
      "default": "Release: Bastion 1.0.0"
    }
  ]
}
